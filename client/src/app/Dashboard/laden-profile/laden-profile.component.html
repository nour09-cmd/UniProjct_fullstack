<div style="padding: 0" *ngIf="counter == false">
  <app-willkommen></app-willkommen>
</div>

<div class="container-main" *ngIf="counter == true">
  <div class="header-section">
    <h1 class="title-dashboard">
      <i class="bi bi-shop"></i>
      Ladenprofil
    </h1>
  </div>

  <form [formGroup]="addressForm" (ngSubmit)="onSubmit()" class="profile-form">
    <!-- Store Details Section -->
    <div class="form-section">
      <h2 class="section-title">Laden Details</h2>
      <div class="input-group">
        <input
          class="form-control"
          [class.is-invalid]="addressForm.get('Laden_name')?.invalid && addressForm.get('Laden_name')?.touched"
          type="text"
          placeholder="Name des Ladens"
          id="Laden_name"
          formControlName="Laden_name"
        />
        <div class="invalid-feedback" *ngIf="addressForm.get('Laden_name')?.invalid && addressForm.get('Laden_name')?.touched">
          Bitte geben Sie einen Ladennamen ein
        </div>
      </div>

      <div class="input-group">
        <textarea
          class="form-control"
          [class.is-invalid]="addressForm.get('Laden_description')?.invalid && addressForm.get('Laden_description')?.touched"
          rows="4"
          placeholder="Beschreibung Ihres Ladens"
          id="Laden_description"
          formControlName="Laden_description"
        ></textarea>
        <div class="invalid-feedback" *ngIf="addressForm.get('Laden_description')?.invalid && addressForm.get('Laden_description')?.touched">
          Bitte geben Sie eine Beschreibung ein
        </div>
      </div>
    </div>

    <!-- Address Section -->
    <div class="form-section">
      <h2 class="section-title">Adresse</h2>
      <div class="address-grid">
        <div class="input-group">
          <input
            class="form-control"
            [class.is-invalid]="addressForm.get('street')?.invalid && addressForm.get('street')?.touched"
            type="text"
            placeholder="Straße"
            formControlName="street"
          />
          <div class="invalid-feedback" *ngIf="addressForm.get('street')?.invalid && addressForm.get('street')?.touched">
            Bitte geben Sie eine Straße ein
          </div>
        </div>

        <div class="input-group">
          <input
            class="form-control"
            [class.is-invalid]="addressForm.get('houseNumber')?.invalid && addressForm.get('houseNumber')?.touched"
            type="text"
            placeholder="Hausnummer"
            formControlName="houseNumber"
          />
          <div class="invalid-feedback" *ngIf="addressForm.get('houseNumber')?.invalid && addressForm.get('houseNumber')?.touched">
            Bitte geben Sie eine Hausnummer ein
          </div>
        </div>

        <div class="input-group">
          <input
            class="form-control"
            [class.is-invalid]="addressForm.get('postalCode')?.invalid && addressForm.get('postalCode')?.touched"
            type="text"
            placeholder="PLZ"
            formControlName="postalCode"
          />
          <div class="invalid-feedback" *ngIf="addressForm.get('postalCode')?.invalid && addressForm.get('postalCode')?.touched">
            Bitte geben Sie eine gültige PLZ ein (5 Ziffern)
          </div>
        </div>

        <div class="input-group">
          <input
            class="form-control"
            [class.is-invalid]="addressForm.get('city')?.invalid && addressForm.get('city')?.touched"
            type="text"
            placeholder="Stadt"
            formControlName="city"
          />
          <div class="invalid-feedback" *ngIf="addressForm.get('city')?.invalid && addressForm.get('city')?.touched">
            Bitte geben Sie eine Stadt ein
          </div>
        </div>
      </div>
    </div>

    <!-- Image Upload Section -->
    <div class="form-section">
      <h2 class="section-title">Bilder</h2>
      <div class="upload-container">
        <div class="upload-box" (click)="fileInput.click()" [class.disabled]="uploadedFilesArray.length >= 3">
          <input
            #fileInput
            type="file"
            (change)="onFileSelected($event)"
            accept="image/jpeg,image/png,image/webp"
            style="display: none"
            [disabled]="uploadedFilesArray.length >= 3"
          />
          <div class="upload-content">
            <i class="bi bi-cloud-upload"></i>
            <p>Bilder hochladen</p>
            <span class="upload-hint">Max. 3 Bilder, JPEG/PNG/WebP, max. 5MB</span>
          </div>
        </div>

        <div class="image-preview-grid" *ngIf="uploadedFilesArray.length > 0">
          <div class="image-preview-item" *ngFor="let image of uploadedFilesArray.controls; let i = index">
            <div class="image-wrapper">
              <img [src]="image.value" alt="Preview" />
              <button type="button" class="btn-remove" (click)="removeImage(i)">
                <i class="bi bi-trash"></i>
              </button>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Submit Button -->
    <div class="form-actions">
      <button
        type="submit"
        class="btn btn-primary"
        [disabled]="addressForm.invalid || isLoading"
      >
        <span *ngIf="!isLoading">Speichern</span>
        <span *ngIf="isLoading" class="spinner-border spinner-border-sm" role="status" aria-hidden="true"></span>
      </button>
    </div>
  </form>
</div>
